import{jsx as e}from"react/jsx-runtime";import{forwardRef as n,useState as t,useRef as r,useEffect as i,useCallback as o,useMemo as s,Children as a}from"react";const c="split-pane-pane",u=n(function(n,t){const{className:r,style:i,children:o,defaultSize:s,size:a,minSize:u,maxSize:l,...d}=n,m={position:"relative",outline:"none",overflow:"auto",flex:"none",...i},h=[c,r].filter(Boolean).join(" ");return e("div",{ref:t,className:h,style:m,"data-pane":"true",...d,children:o})});function l(e,n="polite"){const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live",n),t.setAttribute("aria-atomic","true"),t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)}function d(e){return 1e3>e?Math.round(e)+" pixels":Math.round(e/10)/100+" thousand pixels"}const m="split-pane-divider";function h(n){const{direction:t,index:r,isDragging:i,disabled:o,onMouseDown:s,onTouchStart:a,onTouchEnd:c,onKeyDown:u,className:l,style:d,currentSize:h,minSize:p,maxSize:z,children:f}=n,v="horizontal"===t?"vertical":"horizontal",S={...{flex:"none",position:"relative",userSelect:"none",touchAction:"none",..."horizontal"===t?{width:"1px",cursor:o?"default":"col-resize"}:{height:"1px",cursor:o?"default":"row-resize"},...i&&{cursor:"horizontal"===t?"col-resize":"row-resize"}},...d},y=[m,t,i&&"dragging",l].filter(Boolean).join(" "),g=function(e,n){return`${"horizontal"===n?"vertical":"horizontal"} divider ${e+1}`}(r,t),x=function(e){return`Use ${"horizontal"===e?"left and right arrow keys":"up and down arrow keys"} to resize. Hold Shift for larger steps. Press Home or End to minimize or maximize.`}(t);return e("div",{role:"separator","aria-orientation":v,"aria-label":g,"aria-valuenow":h,"aria-valuemin":p,"aria-valuemax":void 0===z||z===1/0?void 0:z,"aria-description":x,tabIndex:o?-1:0,className:y,style:S,onMouseDown:o?void 0:s,onTouchStart:o?void 0:a,onTouchEnd:o?void 0:c,onKeyDown:o?void 0:u,"data-divider-index":r,children:f})}function p(e,n){if("number"==typeof e)return e;if(e.endsWith("%")){return parseFloat(e)/100*n}if(e.endsWith("px"))return parseFloat(e);const t=parseFloat(e);return isNaN(t)?0:t}function z(e,n,t){return Math.min(Math.max(e,n),t)}function f(e,n,t,r,i){const o=[...e],s=e[n]??0,a=e[n+1]??0,c=r[n+1]??0,u=i[n+1]??1/0;let l=z(s+t,r[n]??0,i[n]??1/0),d=z(a-t,c,u);const m=a-d,h=Math.min(Math.abs(l-s),Math.abs(m));return t>0?(l=s+h,d=a-h):(l=s-h,d=a+h),o[n]=l,o[n+1]=d,o}function v(e){const{direction:n,sizes:s,minSizes:a,maxSizes:c,snapPoints:u=[],snapTolerance:l=10,step:d,onResizeStart:m,onResize:h,onResizeEnd:p}=e,[z,v]=t(!1),[S,y]=t(s),g=r(null),x=r(null),w=r(!0),E=r(S);E.current=S;const b=r(p);b.current=p,z||s===S||JSON.stringify(s)===JSON.stringify(S)||y(s),i(()=>(w.current=!0,()=>{w.current=!1,x.current&&(cancelAnimationFrame(x.current),x.current=null)}),[]);const D=o((e,t)=>{if(!g.current||!w.current)return;const{dividerIndex:r,startPosition:i,startSizes:o}=g.current;let s=("horizontal"===n?e:t)-i;d&&(s=function(e,n){return n>0?Math.round(e/n)*n:e}(s,d));let m=f(o,r,s,a,c);u.length>0&&(m=m.map(e=>function(e,n,t){for(const r of n)if(t>=Math.abs(e-r))return r;return e}(e,u,l))),y(m),h&&h(m,{sizes:m,source:"mouse"})},[n,d,a,c,u,l,h]),A=o(e=>{e.preventDefault(),x.current||(x.current=requestAnimationFrame(()=>{x.current=null,w.current&&D(e.clientX,e.clientY)}))},[D]),R=o(e=>{e.preventDefault(),x.current||(x.current=requestAnimationFrame(()=>{if(x.current=null,w.current){const n=e.touches[0];n&&D(n.clientX,n.clientY)}}))},[D]),k=o(()=>{if(!g.current)return;x.current&&(cancelAnimationFrame(x.current),x.current=null),v(!1);const e=E.current,n=b.current;n&&n(e,{sizes:e,source:"mouse"}),g.current=null},[]),T=o(e=>t=>{t.preventDefault();g.current={dividerIndex:e,startPosition:"horizontal"===n?t.clientX:t.clientY,startSizes:S},v(!0),m&&m({sizes:S,source:"mouse",originalEvent:t.nativeEvent})},[n,S,m]),M=o(e=>t=>{const r=t.touches[0];if(!r)return;g.current={dividerIndex:e,startPosition:"horizontal"===n?r.clientX:r.clientY,startSizes:S},v(!0),m&&m({sizes:S,source:"touch",originalEvent:t.nativeEvent})},[n,S,m]),N=o(e=>{e.preventDefault(),k()},[k]);return i(()=>{if(z)return document.addEventListener("mousemove",A),document.addEventListener("mouseup",k),document.addEventListener("touchmove",R,{passive:!1}),document.addEventListener("touchend",k),()=>{document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",k),document.removeEventListener("touchmove",R),document.removeEventListener("touchend",k)}},[z,A,k,R]),{isDragging:z,currentSizes:S,handleMouseDown:T,handleTouchStart:M,handleTouchEnd:N}}const S=10,y=50;function g(e){const{direction:n,sizes:t,minSizes:i,maxSizes:s,step:a=S,largeStep:c=y,onResize:u,onResizeEnd:m}=e,h=r(null);return{handleKeyDown:o(e=>r=>{if(!("horizontal"===n?["ArrowLeft","ArrowRight"]:["ArrowUp","ArrowDown"]).includes(r.key)&&"Home"!==r.key&&"End"!==r.key&&"Escape"!==r.key)return;if(r.preventDefault(),"Escape"===r.key){if(h.current){const e=h.current;h.current=null,u&&u(e,{sizes:e,source:"keyboard",originalEvent:r.nativeEvent}),m&&m(e,{sizes:e,source:"keyboard",originalEvent:r.nativeEvent}),l("Pane sizes restored")}return}null===h.current&&(h.current=[...t]);let o=0,p=[...t],v="arrow";switch(r.key){case"ArrowLeft":case"ArrowUp":o=-(r.shiftKey?c:a);break;case"ArrowRight":case"ArrowDown":o=r.shiftKey?c:a;break;case"Home":{v="home";const n=e+1,r=i[e]??0,o=(t[e]??0)+(t[n]??0);p[e]=r,p[n]=o-r;break}case"End":{v="end";const n=e,r=e+1,o=(t[n]??0)+(t[r]??0);p[n]=Math.min(s[n]??1/0,o-(i[r]??0)),p[r]=o-p[n];break}}if(0!==o&&(p=f(t,e,o,i,s)),p=p.map((e,n)=>z(e,i[n]??0,s[n]??1/0)),u&&u(p,{sizes:p,source:"keyboard",originalEvent:r.nativeEvent}),m&&m(p,{sizes:p,source:"keyboard",originalEvent:r.nativeEvent}),"home"===v)l(`Pane ${e+1} minimized to ${d(p[e]??0)}`);else if("end"===v)l(`Pane ${e+1} maximized to ${d(p[e]??0)}`);else{const n=o>0?e:e+1;l(`Pane ${n+1} resized to ${d(p[n]??0)}`)}},[n,t,i,s,a,c,u,m])}}const x="split-pane";function w(n){const{direction:c="horizontal",resizable:l=!0,snapPoints:d,snapTolerance:m=10,step:z,onResizeStart:f,onResize:S,onResizeEnd:y,className:w,style:E,divider:b,dividerStyle:D,dividerClassName:A,children:R}=n,k=r(null),[T,M]=t(0),N=r(0),P=s(()=>a.toArray(R).filter(e=>"object"==typeof e&&null!==e&&"props"in e).map(e=>({props:e.props,size:e.props.size,defaultSize:e.props.defaultSize,minSize:e.props.minSize??0,maxSize:e.props.maxSize??1/0})),[R]),L=P.length,$=r(!1);2>L&&!$.current&&($.current=!0,console.warn(`SplitPane requires at least 2 Pane children. Received ${L}.`));const{minSizes:F,maxSizes:K}=s(()=>{if(0===T)return{minSizes:Array(L).fill(0),maxSizes:Array(L).fill(1/0)};const e=[],n=[];return P.forEach(t=>{e.push(p(t.minSize,T)),n.push(t.maxSize===1/0?1/0:p(t.maxSize,T))}),{minSizes:e,maxSizes:n}},[T,L,P]),I=o(e=>{if(0===e)return Array(L).fill(0);const n=P.map(n=>{const t=n.size??n.defaultSize;return void 0!==t?p(t,e):null}),t=n.reduce((e,n)=>e+(n??0),0),r=n.filter(e=>null===e).length,i=r>0?(e-t)/r:0;return n.map(e=>null===e?i:e)},[L,P]),[j,O]=t(()=>I(T)),C=o(e=>{const n=N.current;N.current=e,0!==e&&O(t=>t.every(e=>0===e)||t.length!==L?I(e):n>0&&n!==e?function(e,n){const t=e.reduce((e,n)=>e+n,0);if(0===t){const t=n/e.length;return e.map(()=>t)}return e.map(e=>e/t*n)}(t,e):0===n?I(e):t)},[L,I]);i(()=>{const e=k.current;if(!e)return;const n=new ResizeObserver(e=>{const n=e[0];n&&(e=>{const n="horizontal"===c?e.width:e.height;n>0&&(M(n),C(n))})(n.contentRect)});return n.observe(e),()=>{n.disconnect()}},[c,C]);const H=o((e,n)=>{O(e),S?.(e,n)},[S]),{isDragging:J,currentSizes:X,handleMouseDown:Y,handleTouchStart:q,handleTouchEnd:B}=v({direction:c,sizes:j,minSizes:F,maxSizes:K,snapPoints:d,snapTolerance:m,step:z,onResizeStart:f,onResize:H,onResizeEnd:y}),{handleKeyDown:U}=g({direction:c,sizes:X,minSizes:F,maxSizes:K,step:z,onResize:H,onResizeEnd:y}),W={display:"flex",flexDirection:"horizontal"===c?"row":"column",height:"100%",width:"100%",overflow:"hidden",position:"relative",...E},G=[x,c,w].filter(Boolean).join(" ");return e("div",{ref:k,className:G,style:W,children:T>0&&(()=>{if(2>L)return null;const n=[];return P.forEach((t,r)=>{const i=X[r]??0,o={..."horizontal"===c?{width:i+"px",height:"100%"}:{height:i+"px",width:"100%"},...t.props.style};if(n.push(e(u,{...t.props,style:o,children:t.props.children},"pane-"+r)),L-1>r){const t=F[r],o=K[r];n.push(e(b??h,{direction:c,index:r,isDragging:J,disabled:!l,onMouseDown:Y(r),onTouchStart:q(r),onTouchEnd:B,onKeyDown:U(r),className:A,style:D,currentSize:i,minSize:t,maxSize:o===1/0?void 0:o},"divider-"+r))}}),n})()})}function E(e){const{key:n,storage:r=localStorage,debounce:o=300}=e,[s,a]=t(()=>{try{const e=r.getItem(n);return e?JSON.parse(e):[]}catch{return[]}});return i(()=>{if(0===s.length)return;const e=setTimeout(()=>{try{r.setItem(n,JSON.stringify(s))}catch(e){console.warn("Failed to persist pane sizes:",e)}},o);return()=>clearTimeout(e)},[s,n,r,o]),[s,a]}export{h as Divider,u as Pane,w as SplitPane,g as useKeyboardResize,E as usePersistence,v as useResizer};
//# sourceMappingURL=index.js.map
